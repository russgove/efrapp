define("uK",["require","exports","ap","u0","uY","uX","uO","iB","od","iw","uN","aC","uM","uL","sP","bb","bA"],function(e,t,r,a,o,i,s,u,l,d,p,c,m,f,h,n,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=10737418240,_=n.isFeatureEnabled(n.UseVroomUpload);t.useVroomUploadResourceKey=new y.ResourceKey({name:e("module").id+".useVroomUpload",factory:new y.ConstantResourceFactory(_)});var g=function(n){r.__extends(e,n);function e(e,t){var r=n.call(this,e,t)||this;r.maxFileSize=v;r._itemsStore=t.itemsStore;r._pageContext=t.pageContext;r._listContext=t.listContext;r._postUploadProjectionHelper=t.postUploadProjectionHelper;r._singleFileUploaderType=t.singleFileUploaderType;r._vroomSingleFileUploaderType=t.vroomSingleFileUploaderType;r._useVroomUpload=t.useVroomUpload;r._shouldUpdateItemSet=e.skipInvalidation;r._uploadMetadata=e.metadata;r._itemSet=e.itemSet;r._topLevelUploaders=[];var a=r._pageContext.maximumFileSize,o=void 0!==a?1024*a*1024:v;r.maxFileSize=o;return r}e.prototype.validateFile=function(e){var t=e.fileUpload;return-1<p.indexOfIllegalCharInUrlLeafName(t.name,this._pageContext)?c.default.wrapError(new f.UploadError({message:m.strings.illegalFileNameError,errorType:h.UploadErrorType.other})):c.default.wrap()};e.prototype.createSingleFileUploader=function(e){var t,r=e.fileUpload,a=e.parentItem;t=this._useVroomUpload&&this._vroomSingleFileUploaderType?new(this.scope.attached(this._vroomSingleFileUploaderType))({fileUpload:r,parentItem:a,qosContext:{uploadType:i.Html5,isDragAndDrop:this.wasDragAndDropped,isFolderUpload:!0}}):new(this.scope.attached(this._singleFileUploaderType))({fileUpload:r,parentItem:a,qosContext:{folderUpload:!0,wasDraggedAndDropped:this.wasDragAndDropped},metadata:this._uploadMetadata});a===this.parentItem&&this._topLevelUploaders.push(t);return t};e.prototype.onBatchComplete=function(){if(this._shouldUpdateItemSet){for(var e=[],t=0,r=this._topLevelUploaders;t<r.length;t++){var a=r[t],o=this.peekUnwrapObservable(a.item);if(o){var n=this._itemsStore.getItem(o.key);n&&e.push(n)}}this._postUploadProjectionHelper.updateItemSetPostUpload(this._itemSet,e,this._uploadMetadata?this._uploadMetadata.group:null)}};e.prototype.isSPList=function(){return 700!==this._listContext.listTemplateType};e.prototype.libraryName=function(){return this._listContext.listTitle};e.dependencies=r.__assign({},a.default.dependencies,{pageContext:d.pageContext,itemsStore:u.resourceKey,listContext:d.listContext,postUploadProjectionHelper:l.resourceKey,singleFileUploaderType:o.typeResourceKey,vroomSingleFileUploaderType:_?s.resourceKey:void 0,useVroomUpload:t.useVroomUploadResourceKey});return e}(a.default);t.default=g;t.typeResourceKey=y.createResolvedTypeResourceKey(e("module").id,g)});define("u0",["require","exports","ap","bN","ia","aC","bE","uL","aI","u5","sP","u4","u2","u1"],function(e,t,r,a,i,u,s,l,d,o,p,c,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(n){r.__extends(e,n);function e(e,t){var r=n.call(this,{},t)||this,a=e.batchStartTime,o=void 0===a?Date.now():a;r.filesUploading=r.observables.createArray();r.wasDragAndDropped=e.wasDragAndDropped;r.parentItem=e.parentItem;r._behavior=e.behavior;r._fileList=e.files;r.batchStartTime=o;r._fileReader=new FileReader;r._fileReaderQueue=new i.default;r._startUploadQueue=new i.default;r._html5FileUploadType=t.html5FileUploadType;r._singleErrorUploaderType=t.singleErrorUploaderType;r._singleFolderUploaderType=t.singleFolderUploaderType;return r}e.prototype.start=function(){var a=this,e=new d.Qos({name:"BatchUploader.start"});return this.beforeStart().then(function(){var e,t,r=a._fileList;e=(t=r[0])&&"function"==typeof(t.slice||t.mozSlice||t.webkitSlice)&&"size"in t?f.buildEntriesFromFileList(r):f.buildEntriesFromEntryList(r);return u.default.all(e.map(function(e,t){return a._getUpload(e,a.parentItem,t)})).then(function(e){return u.default.all(e.map(function(e){return e.wait}))}).then(function(){})}).then(function(){e.end({resultType:d.ResultTypeEnum.Success});a.onBatchComplete()},function(){e.end({resultType:d.ResultTypeEnum.Failure});a.onBatchComplete()})};e.prototype.beforeStart=function(){return u.default.wrap()};e.prototype.validateFile=function(e){return u.default.wrap()};e.prototype.onBatchComplete=function(){};e.prototype.isSPList=function(){return!1};e.prototype.libraryName=function(){return""};e.prototype._isFolder=function(r){var a=this,o=this._fileReader;return this._fileReaderQueue.enqueue(function(){var t=new s.default;a.events.on(o,"load",function(){t.complete(!1)});a.events.on(o,"error",function(){t.complete(!0)});var e=r.slice||r.mozSlice||r.webkitSlice;try{o.readAsArrayBuffer(e.call(r,0,Math.min(1,r.size)))}catch(e){t.complete(!0)}return t.getPromise().then(function(e){a.events.off(o);return e})})};e.prototype._getUpload=function(e,t,r){var a=this,o=new d.Qos({name:"BatchUploader.getUpload"});return this._startUploadQueue.enqueue(function(){var e,t=new s.default(function(){e&&a.async.clearTimeout(e)});e=a.async.setTimeout(function(){return t.complete()},0);return t.getPromise()}).then(function(){return 2===e.type?a._getDirectoryUpload(e,t):a._getUnknownUpload(e,t,r)}).then(function(e){o.end({resultType:d.ResultTypeEnum.Success});return e},function(e){o.end({resultType:d.ResultTypeEnum.Failure});return u.default.wrapError(e)})};e.prototype._getUploadsForDirectoryPage=function(e,r,a){var o=this,t=e.entries,n=[u.default.all(t.map(function(e,t){return o._getUpload(e,r,a+t)}))];e.getEntries&&n.push(e.getEntries().then(function(e){return o._getUploadsForDirectoryPage(e,r,a+t.length)}));return u.default.all(n).then(function(e){return[].concat.apply([],e)})};e.prototype._getDirectoryUpload=function(e,t){var r=this,a=new s.default,o=new(this.scope.attached(this._singleFolderUploaderType))({name:e.name,parentItem:t,onCreateFolder:function(t){return e.getEntries().then(function(e){return r._getUploadsForDirectoryPage(e,t,0)}).then(function(e){a.complete(e)},function(e){a.error(e)})}}),n={wait:this._waitForUploader(o).then(function(){return a.getPromise()}).then(function(e){return u.default.all(e.map(function(e){return e.wait}))}).then(function(){})};return u.default.wrap(n)};e.prototype._getUnknownUpload=function(o,n,i){var s=this;return o.getFile().then(function(t){var e,r;e=0===o.type?s._isFolder(t).then(function(e){r=!0;if(e)return u.default.wrapError(new l.UploadError({message:"",errorType:p.UploadErrorType.folderUploadNotSupported}))}):u.default.wrap();var a=new s._html5FileUploadType({file:t});return e.then(function(){return s._validateFile({fileUpload:a})}).then(function(){return s.validateFile({fileUpload:a,parentItem:n,index:i})}).then(function(){return s.createSingleFileUploader({fileUpload:a,parentItem:n,index:i})},function(e){return new(s.scope.attached(s._singleErrorUploaderType))({name:t.name,parentItem:n,isFolder:r,error:e})})},function(e){return new(s.scope.attached(s._singleErrorUploaderType))({name:o.name,parentItem:n,isFolder:!1,error:new l.UploadError({errorType:p.UploadErrorType.general,message:""})})}).then(function(e){return{wait:s._waitForUploader(e)}})};e.prototype._waitForUploader=function(t){var r=new s.default(function(){t.abort()});this.observables.backgroundCompute(function(){var e=t.state.peek();2===e?r.complete():4===e?r.error(t.error.peek()||new Error("Unknown error from uploader.")):3===e?r.cancel():t.state()});this._addUploader(t);t.start();return r.getPromise()};e.prototype._validateFile=function(e){var t=e.fileUpload;return t.name?t.size?void 0!==this.maxFileSize&&t.size>this.maxFileSize?u.default.wrapError(new l.UploadError({message:"",errorType:p.UploadErrorType.fileSize,maxSizeInBytes:this.maxFileSize})):u.default.wrap():u.default.wrapError(new l.UploadError({message:"",errorType:this.isSPList()?p.UploadErrorType.emptyFileOrFolderForDocLib:p.UploadErrorType.emptyFileOrFolder,libraryName:this.libraryName()})):u.default.wrapError(new l.UploadError({message:"",errorType:p.UploadErrorType.invalidName}))};e.prototype._addUploader=function(e){var t=this._behavior;t&&e.nameConflictBehavior(t);this.filesUploading.push(e);return e};e.dependencies=r.__assign({},a.default.dependencies,{html5FileUploadType:m.typeResourceKey,singleErrorUploaderType:c.typeResourceKey,singleFolderUploaderType:o.typeResourceKey});return e}(a.default);t.default=n});define("uL",["require","exports","sP"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){this.message=e.message;this.errorType=e.errorType||r.UploadErrorType.other;this.maxSizeInBytes=e.maxSizeInBytes;this.allowRename=e.allowRename||!1;this.allowMerge=e.allowMerge||!1;this.extraData=e.extraData;this.libraryName=e.libraryName;this.isFolder=e.isFolder};t.UploadError=a;t.default=a});define("sP",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.none=0]="none";e[e.other=1]="other";e[e.general=2]="general";e[e.conflict=3]="conflict";e[e.invalidName=4]="invalidName";e[e.fileSize=5]="fileSize";e[e.emptyFileOrFolder=6]="emptyFileOrFolder";e[e.emptyFileOrFolderForDocLib=7]="emptyFileOrFolderForDocLib";e[e.overQuota=8]="overQuota";e[e.accessDenied=9]="accessDenied";e[e.lockMismatch=10]="lockMismatch";e[e.overQuotaSharedFolder=11]="overQuotaSharedFolder";e[e.folderUploadNotSupported=12]="folderUploadNotSupported";e[e.versionMismatch=13]="versionMismatch"}(t.UploadErrorType||(t.UploadErrorType={}))});define("u5",["require","exports","ap","bN","ia","sP","uL","dY","bA"],function(e,t,r,a,o,n,i,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.uploadQueueResourceKey=new u.ResourceKey({name:e("module").id+".uploadQueue",factory:{dependencies:{},create:function(){return{instance:new o.default(3)}}}});var l=function(o){r.__extends(e,o);function e(e,t){var r=o.call(this,e,t)||this;r._itemDataSource=t.itemDataSource;r._uploadQueue=t.uploadQueue;r._parentItem=e.parentItem;r._onCreateFolder=e.onCreateFolder;r.allowRename=!1;var a=r.observables;r.item=a.create();r.state=a.create(0);r.uploadedBytes=a.create(0);r.totalBytes=a.create(0);r.fileName=a.create(e.name);r.iconName=a.create("folder");r.error=a.create();r.nameConflictBehavior=a.create(0);return r}e.prototype.start=function(){this._uploadPromise=this.trackPromise(this._upload())};e.prototype.abort=function(){this.error(void 0);this.state(3);var e=this._uploadPromise;delete this._uploadPromise;e&&e.cancel()};e.prototype.restart=function(){var e=this,t=this._uploadPromise;delete this._uploadPromise;t&&t.cancel();t.then(function(){},function(){}).done(function(){e.start()})};e.prototype._upload=function(){var r=this;this.state(1);return this._uploadQueue.enqueue(function(){return r._itemDataSource.createFolder({parent:r._parentItem,folderName:r.fileName.peek(),needItemDetails:!0})}).then(function(e){r.item(e);return r._onCreateFolder(e)}).then(function(){r.state(2)},function(e){var t;t=e instanceof Error?e.message:e;r.error(new i.UploadError({errorType:n.UploadErrorType.other,message:t}));r.state(4)})};e.dependencies=r.__assign({},a.default.dependencies,{itemDataSource:s.items,uploadQueue:t.uploadQueueResourceKey});return e}(a.default);t.default=l;t.typeResourceKey=u.createResolvedTypeResourceKey(e("module").id,l)});define("u4",["require","exports","ap","bN","bA","gH","dp"],function(e,t,r,a,o,p,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(d){r.__extends(e,d);function e(e,t){var r=d.call(this,e,t)||this,a=e.name,o=e.parentItem,n=e.isFolder,i=e.error;r._error=i;var s=p.getFileExtension(a),u=n?"folder":c.getIconNameFromExtension(s);r._parentItem=o;r.allowRename=!1;var l=r.observables;r.item=l.create();r.state=l.create(4);r.uploadedBytes=l.create(0);r.totalBytes=l.create(0);r.fileName=l.create(a);r.iconName=l.create(u);r.error=l.create(r._error);r.nameConflictBehavior=l.create(0);return r}e.prototype.start=function(){this.error(this._error);this.state(4)};e.prototype.abort=function(){this.error(void 0);this.state(3)};e.prototype.restart=function(){this.start()};return e}(a.default);t.default=n;t.typeResourceKey=o.createResolvedTypeResourceKey(e("module").id,n)});define("u2",["require","exports","u3","by","bA"],function(e,t,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Html5FileUpload=r.Html5FileUpload;t.typeResourceKey=o.createResolvedTypeResourceKey(e("module").id,r.Html5FileUpload,{platformDetection:a.platformDetection});t.default=r.Html5FileUpload});define("u3",["require","exports","dp","gI"],function(e,t,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=0,r=function(){function e(e,t){var r=e.file;this._file=r;this.eTag=r.eTag;var a,o=r.fileName||r.name,n=p.splitFileName(o),i=n.name,s=n.extension;this.extension=s;this.iconName=d.getIconNameFromExtension(s);this.size=r.size;if(t.platformDetection.isIOS&&"image"===i&&"photo"===this.iconName){var u=r.lastModifiedDate,l=void 0===u?new Date:u;a="IMG_"+this._getLastModifiedISO8601(l)+"_"+ ++c+s}else a=o;r.lastModifiedDate&&(this.lastModifiedDate=r.lastModifiedDate);this.name=a}e.prototype.slice=function(e,t){var r=this._file;return(r.slice||r.mozSlice||r.webkitSlice).call(r,e,t)};e.prototype._getLastModifiedISO8601=function(e){return e.getUTCFullYear()+"-"+a(e.getUTCMonth()+1,2)+"-"+a(e.getUTCDate(),2)+" "+a(e.getUTCHours(),2)+"-"+a(e.getUTCMinutes(),2)+"-"+a(e.getSeconds(),2)};return e}();t.Html5FileUpload=r;function a(e,t){for(var r=""+e;r.length<t;)r="0"+r;return r}t.default=r});define("u1",["require","exports","bE","aC"],function(e,t,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function i(e){return{name:e.name,type:2,getEntries:function(){return a.default.resolve({entries:d(e)})}}}function s(e){return e.type?{name:e.name,type:1,getFile:function(){return a.default.resolve(e)}}:{name:e.name,type:0,getFile:function(){return a.default.resolve(e)}}}function d(e){var t=[];for(var r in e.directories)r&&t.push(i(e.directories[r]));for(var a=0,o=e.files;a<o.length;a++){var n=o[a];t.push(s(n))}return t}t.buildEntriesFromFileList=function(e){for(var t={name:"",directories:{},files:[]},r=0,a=e;r<a.length;r++){for(var o=a[r],n=o.webkitRelativePath,i=t,s=0,u=(void 0===n?o.name:n).split("/").slice(0,-1);s<u.length;s++){var l=u[s];i=i.directories[l]||(i.directories[l]={name:l,directories:{},files:[]})}i.files.push(o)}return d(t)};function o(t){return function(e){var t=new r.default;e.readEntries(function(e){return t.complete(e)},function(e){return t.error(e)});return t.getPromise()}(t).then(function(e){return e.length?{entries:e.map(n),getEntries:function(){return o(t)}}:{entries:[]}})}function n(e){var t;e.isDirectory?t={name:e.name,type:2,getEntries:function(){return o(e.createReader())}}:e.isFile&&(t={name:e.name,type:1,getFile:function(){return function(e){var t=new r.default;e.file(function(e){t.complete(e)},function(e){t.error(e)});return t.getPromise()}(e)}});return t}t.buildEntriesFromEntryList=function(e){return e.map(n)}});define("uY",["require","exports","ap","bN","aC","aZ","fd","aI","aM","sP","uL","uX","eP","dY","eG","fG","fS","gf","uZ","bE","bb","ia","fH","eL","eK","gH","fn","bc","bA"],function(e,t,r,a,u,f,i,l,o,d,p,c,n,m,h,y,v,_,g,U,S,s,T,E,F,R,w,x,D){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var b=1048576,C=8*b,I=250*b,k=-2130575257,P=new s.default(3),q=function(s){r.__extends(e,s);function e(e,t){var r=s.call(this,e,t)||this,a=e.fileUpload,o=e.parentItem,n=e.metadata,i=e.qosContext;r._qosContext=i;r._parentItem=o;r._fileUpload=a;r._uploadId=null;r._chunkNumber=0;r._streamingChunkNumber=0;r._currentChunkSize=C;r._currentStreamingChunkSize=I;r._itemProvider=t.itemProvider;r._urlDataSource=t.urlDataSource;r._itemParentHelper=t.itemParentHelper;r._itemUrlHelper=t.itemUrlHelper;r._apiUrlHelper=t.apiUrlHelper;r._dataRequestor=new t.dataRequestorType({qosName:"SingleFileUploader"});r.totalBytes=r.createObservable(a.size);r.uploadedBytes=r.createObservable(0);r.fileName=r.createObservable(a.name);r.iconName=r.createObservable(a.iconName);r.state=r.createObservable(0);r.error=r.createObservable(null);r.nameConflictBehavior=r.createObservable(0);r.allowRename=!1;r.item=r.createObservable();r._uploadMetadata=n;r._itemTaskObserver=new t.itemTaskObserverType;return r}e.prototype.start=function(){var o=this;this.state(0);var n=this._getItemKey();this._itemTaskObserver.update([new F.default(n).succeed({item:{key:n,state:{upload:{status:1}}}})]);this._itemTaskObserver.flush();this.item(this._itemTaskObserver.getItem({key:n}));var e=P.enqueue(function(){o.error(void 0);o.state(1);var e=o._fileUpload,a=new i.Upload({name:"Upload."+c.Html5,dragAndDrop:o._qosContext.wasDraggedAndDropped,size:e.size,extension:e.extension.substring(1),folderUpload:o._qosContext.folderUpload,groupFolder:!1,extraData:{uploaderType:"ODB"}});return o._upload().then(function(){if(!o._uploadMetadata||!o._uploadMetadata.group){o._itemTaskObserver.update([new F.default(n).succeed({item:{key:n,state:{upload:{status:2}}}})]);o._itemTaskObserver.flush();o.item(o._itemTaskObserver.getItem({key:n}))}o.state(2);a.end({resultType:l.ResultTypeEnum.Success})},function(e){if(u.default.isCanceled(e)){var t=o.item.peek().key;o._itemTaskObserver.update([new F.default(t).succeed({item:{key:t,state:{upload:{status:3}}}})]);o._itemTaskObserver.flush();o.item(o._itemTaskObserver.getItem({key:t}));a.end({resultType:l.ResultTypeEnum.ExpectedFailure,resultCode:"Aborted"});return u.default.wrapError(e)}var r;if((r=e instanceof p.UploadError?e:new p.UploadError({message:e&&e.message||"",errorType:d.UploadErrorType.general})).errorType!==d.UploadErrorType.conflict){o._itemTaskObserver.update([new F.default(n).succeed({item:{key:n,state:{upload:{status:4}}}})]);o._itemTaskObserver.flush()}o.item(o._itemTaskObserver.getItem({key:n}));o.error(r);o.state(4);a.end({resultType:l.ResultTypeEnum.Failure,resultCode:d.UploadErrorType[r.errorType]});return u.default.wrapError(e)})});return this._uploadPromise=e};e.prototype.abort=function(){var e=this;if(2!==this.state.peek()){this.error(null);this.state(3);var t=this._uploadPromise;this._uploadPromise=void 0;if(t){t.cancel();t.then(function(){},function(){}).done(function(){return e._cancelChunkUpload()})}}};e.prototype.restart=function(){var e,t=this,r=this._uploadPromise;this._uploadPromise=void 0;if(r){r.cancel();e=r.then(void 0,function(){return t._cancelChunkUpload().then(void 0,function(){})})}else e=u.default.wrap();e.done(function(){t.start()})};e.prototype._upload=function(){var e,t=this;this.uploadedBytes(0);var r=this._fileUpload.size;if(r<=25165824&&!S.isFeatureEnabled(S.UploadStreamingIrmEnabled))e=this._sendSingleRequestUpload();else if(S.isFeatureEnabled(S.EnableStreamingUpload)){this._maxUploadRequestDuration=15e4;e=this._sendStreamingUpload()}else{this._maxUploadRequestDuration=6e4;e=this._uploadFragment()}return e.then(function(e){t.uploadedBytes(r);t.item(e);return t._updateMetadata(e)})};e.prototype._createUploadError=function(e){var t,r,a;if("string"==typeof e)r=e;else{t=this._getErrorCode(e);var o=e.message;"string"==typeof o?r=o:o&&(r=o.value)}a=t===k?d.UploadErrorType.conflict:-1===t?d.UploadErrorType.general:r?d.UploadErrorType.other:d.UploadErrorType.general;return new p.UploadError({message:r,errorType:a,allowRename:this.allowRename})};e.prototype._getErrorCode=function(e){var t=e.code;return(void 0===t?"":t).split(",").map(function(e){return Number(e)})[0]};e.prototype._getUploadFileUrl=function(){var e=this._parentItem.properties.uniqueId,t=this._itemUrlHelper.getItemUrlParts(this._parentItem.key),r=this._apiUrlHelper.build().webByItemUrl(t);r=e?r.method("GetFolderById",e):S.isFeatureEnabled(S.SupportPoundPercent)?r.methodWithAliases("GetFolderByServerRelativePath",{DecodedUrl:t.serverRelativeItemUrl}):r.method("GetFolderByServerRelativeUrl",t.serverRelativeItemUrl);var a=this._fileUpload.name,o=1===this.nameConflictBehavior.peek();r=r.segment("Files");r=S.isFeatureEnabled(S.SupportPoundPercent)?r.methodWithAliases("AddUsingPath",{DecodedUrl:a,overwrite:o}):r.methodWithAliases("Add",{url:a,overwrite:o});var n=x.default.isActivated("15F6DAC6-107D-453B-B063-9AFF26D5C579","9/19/2017","Always expand all list item fields on upload")?null:"ListItemAllFields";this._uploadMetadata&&(n="ListItemAllFields");var i=this.peekUnwrapObservable(this._itemParentHelper.getFacetedAncestorOrSelf(this._parentItem,"list"));if(i){var s=i.list;s.contentTypesEnabled&&s.templateType!==w.default.mySiteDocumentLibrary&&(n=(n||"ListItemAllFields")+"/ContentType/Fields")}n&&(r=r.oDataParameter("$Expand",n));return r.toString()};e.prototype._isConflictFile=function(){var r=this;if(1===this.nameConflictBehavior())return u.default.wrap(!1);var e=this._itemUrlHelper.getItemUrlParts(this._parentItem.key),t=this._apiUrlHelper.build().webByItemUrl(e);t=(t=S.isFeatureEnabled(S.SupportPoundPercent)?t.methodWithAliases("GetFolderByServerRelativePath",{DecodedUrl:e.serverRelativeItemUrl}):t.method("GetFolderByServerRelativeUrl",e.serverRelativeItemUrl)).segment("Files").oDataParameter("$filter","Name eq '"+o.default.encodeRestUriStringToken(this._fileUpload.name)+"'");return this._dataRequestor.getData({url:t.toString(),qosName:"GetFile",parseResponse:function(e){var t=JSON.parse(e);return!!(t&&t.d&&t.d.results&&0<t.d.results.length)&&!(t.d.results[0].Exists&&0<r._streamingChunkNumber)}}).then(function(e){return e},function(e){return!!u.default.isCanceled(e)&&u.default.wrapError(e)})};e.prototype._processUploadCompleteResponse=function(e){return this._getItemFromResponse(e)};e.prototype._getItemFromResponse=function(e){var t;try{var r=JSON.parse(e);r=r.d;var a=this._getItemKey(),o=void 0;r.ListItemAllFields&&r.ListItemAllFields.Id&&(o=String(r.ListItemAllFields.Id));var n=!1;if(r.ListItemAllFields&&r.ListItemAllFields.ContentType&&r.ListItemAllFields.ContentType.Fields&&r.ListItemAllFields.ContentType.Fields.results){var i=r.ListItemAllFields.ContentType.Fields.results.filter(function(e){return e.Required});if(0<i.length)for(var s=0,u=i;s<u.length;s++){var l=u[s];if(!r.ListItemAllFields[l.InternalName]){n=!0;break}}}var d=void 0;r.UniqueId&&(d=f.default.normalizeLower(r.UniqueId));var p=r.Name,c=R.getFileExtension(p),m=this._itemTaskObserver;m.update([new F.default(a).succeed({item:{key:a,parentKey:this._parentItem.key,type:h.default.File,id:r.ServerRelativeUrl,name:p,displayName:p,extension:c,properties:{ID:o,uniqueId:d},itemFromServer:r,hasMissingMetadata:n}})]);m.flush();t=m.getItem({key:a})}catch(e){}return t};e.prototype._generateChunkPostUrl=function(e,t){var r,a=this._fileUpload,o=this._parentItem.properties.uniqueId,n=a.size<=t,i=this._itemUrlHelper.getItemUrlParts(this._parentItem.key),s=this._apiUrlHelper.build().webByItemUrl(i),u={uploadId:{guid:this._uploadId}};if(0===this._chunkNumber&&0===this._streamingChunkNumber){r="StartUpload";s=(s=o?s.method("GetFolderById",o):S.isFeatureEnabled(S.SupportPoundPercent)?s.methodWithAliases("GetFolderByServerRelativePath",{DecodedUrl:i.serverRelativeItemUrl}):s.method("GetFolderByServerRelativeUrl",i.serverRelativeItemUrl)).segment("Files");s=1===this.nameConflictBehavior.peek()?S.isFeatureEnabled(S.SupportPoundPercent)?s.methodWithAliases("GetByPathOrAddStub",{DecodedUrl:a.name}):s.method("GetByUrlOrAddStub",a.name):S.isFeatureEnabled(S.SupportPoundPercent)?s.methodWithAliases("AddStubUsingPath",{DecodedUrl:a.name}):s.method("AddStub",a.name)}else{if(n){r="FinishUpload";this._uploadMetadata&&(s=s.oDataParameter("$Expand","ListItemAllFields"))}else r="ContinueUpload";s=S.isFeatureEnabled(S.SupportPoundPercent)?s.methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:i.serverRelativeItemUrl+"/"+a.name}):s.method("GetFileByServerRelativeUrl",i.serverRelativeItemUrl+"/"+a.name);u.fileOffset=e}return(s=s.methodWithAliases(r,u)).toString()};e.prototype._getUploadStatus=function(){var e=this._fileUpload,t=this._uploadId,r=this._itemUrlHelper.getItemUrlParts(this._parentItem.key),a=this._apiUrlHelper.build().webByItemUrl(r);a=a.methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:r.serverRelativeItemUrl+"/"+e.name}).methodWithAliases("GetUploadStatus",{uploadId:{guid:t}});return this._dataRequestor.getData({url:a.toString(),qosName:"GetUploadStatus",method:"GET"}).then(function(e){if(e.d&&e.d.ExpectedContentRange){return parseInt(e.d.ExpectedContentRange.split("-")[0],10)}return u.default.wrapError()})};e.prototype._uploadFragment=function(o,n){var i=this;void 0===o&&(o=0);void 0===n&&(n=3);var t=this._fileUpload.size,r=Math.min(this._currentChunkSize+o,t);this._uploadId||(this._uploadId=f.default.generate());var a=Date.now();return this._sendFileData({url:this._generateChunkPostUrl(o,r),qosName:"SendFileRequest",data:this._fileUpload.slice(o,r),offset:o,length:r-o}).then(function(e){i.uploadedBytes(r);if(r<t){i._chunkNumber++;Date.now()-a<6e4&&(i._currentChunkSize=Math.min(Math.floor(i._currentChunkSize*Math.pow(2,.25)),62914560));return i._uploadFragment(r)}return i._processUploadCompleteResponse(e)},function(e){if(u.default.isCanceled(e))return u.default.wrapError(e);if(-2===i._getErrorCode(e)){if(262144<i._currentChunkSize){i._currentChunkSize=Math.max(Math.floor(i._currentChunkSize/2),262144);var t=void 0;0===i._chunkNumber&&(t=i._cancelChunkUpload());return u.default.as(t).then(function(){return i._uploadFragment(o)})}}else if(0<n&&i._canRetry(e)){var r,a=new U.default(function(){r&&i.async.clearTimeout(r)});r=i.async.setTimeout(function(){return a.complete()},1e3);return a.getPromise().then(function(){return i._uploadFragment(o,n-1)})}return u.default.wrapError(i._createUploadError(e))})};e.prototype._sendSingleRequestUpload=function(){var r=this;return this._isConflictFile().then(function(e){if(e){var t=new p.UploadError({message:"",errorType:d.UploadErrorType.conflict});return u.default.wrapError(t)}return r._fileUpload.slice(0,r._fileUpload.size)}).then(function(e){return r._sendFileData({url:r._getUploadFileUrl(),qosName:"UploadFile",data:e,offset:0,length:e.size}).then(function(e){return r._processUploadCompleteResponse(e)}).then(function(e){return e},function(e){if(u.default.isCanceled(e))return u.default.wrapError(e);if(-2===r._getErrorCode(e)){r.nameConflictBehavior(1);return r._uploadFragment()}return u.default.wrapError(r._createUploadError(e))})})};e.prototype._sendStreamingUpload=function(r,o){var n=this;void 0===r&&(r=0);void 0===o&&(o=3);this._uploadId||(this._uploadId=f.default.generate());var t=this._fileUpload.size,a=0<this._streamingChunkNumber?Math.min(this._currentStreamingChunkSize+r,t):0;return this._isConflictFile().then(function(e){if(e){var t=new p.UploadError({message:"",errorType:d.UploadErrorType.conflict});return u.default.wrapError(t)}return n._fileUpload.slice(r,a)}).then(function(e){return n._sendFileData({url:n._generateChunkPostUrl(r,a),qosName:"SendFileRequest",data:e,offset:r,length:e.size}).then(function(e){n.uploadedBytes(a);if(a<t){n._streamingChunkNumber++;return n._sendStreamingUpload(a,o)}return n._processUploadCompleteResponse(e)},function(a){if(u.default.isCanceled(a))return u.default.wrapError(a);if(-2===n._getErrorCode(a)){if(n._currentStreamingChunkSize<=1048576)return u.default.wrapError(n._createUploadError(a));n._currentStreamingChunkSize=n._currentStreamingChunkSize/2}return n._getUploadStatus().then(function(e){return n._sendStreamingUpload(e,3)},function(e){if(0<o&&n._canRetry(a)){var t,r=new U.default(function(){t&&n.async.clearTimeout(t)});t=n.async.setTimeout(function(){return r.complete()},1e3);return r.getPromise().then(function(){return n._sendStreamingUpload(0,o-1)})}return u.default.wrapError(n._createUploadError(a))})})})};e.prototype._canRetry=function(e){var t;switch(this._getErrorCode(e)){case-1:case k:case-2130575142:t=!1;break;default:t=!0}return t};e.prototype._cancelChunkUpload=function(){var e=this._uploadId;this._uploadId=void 0;this._chunkNumber=0;if(e){var t=this._fileUpload,r=this._itemUrlHelper.getItemUrlParts(this._parentItem.key),a=this._apiUrlHelper.build().webByItemUrl(r);a=(a=S.isFeatureEnabled(S.SupportPoundPercent)?a.methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:r.serverRelativeItemUrl+"/"+t.name}):a.method("GetFileByServerRelativeUrl",r.serverRelativeItemUrl+"/"+t.name)).methodWithAliases("CancelUpload",{uploadId:{guid:e}});return this._dataRequestor.getData({url:a.toString(),qosName:"CancelUploadSession"}).then(function(){})}return u.default.wrap()};e.prototype._updateMetadata=function(t){var e,r=this;if(this._uploadMetadata&&this._uploadMetadata.group){var a=new U.default;this.resources.consumeAsync(g.resourceKey.optional).then(function(e){e?e.updateItemMetadata({items:[t],metadata:r._uploadMetadata,onComplete:function(){a.complete()}}):a.complete()});e=a.getPromise()}else e=u.default.wrap();return e};e.prototype._sendFileData=function(e){var t,a,r,o=this,n=e.url,i=e.qosName,s=e.data,u=e.offset,l=e.length,d=new U.default(function(){t.cancel()}),p=function(e){var t=0<o._chunkNumber&&u+l>=o._fileUpload.size?3e5:1e4,r=Math.max(.08*e,t);a&&o.async.clearTimeout(a);e&&(a=o.async.setTimeout(function(){d.error({code:"-1",message:""})},r))},c=Date.now(),m=Date.now(),f=0,h=0,y=0,v=this.async.debounce(function(e){e>o.uploadedBytes.peek()&&o.uploadedBytes(e)},100,{leading:!1});t=this._dataRequestor.getData({url:n,qosName:i,parseResponse:function(e){return e},contentType:"application/octet-stream",additionalPostData:s,onUploadProgress:function(e){if(e.lengthComputable){var t=Date.now();h+=(e.loaded-f)/(t-m);y++;r=e.loaded/(t-c);m=t;f=e.loaded;v(u+e.loaded);p(l-e.loaded)}}});p(l);var _=this.async.setInterval(function(){if(y){Date.now()-c+(l-f)/((h+r)/(y+1))>o._maxUploadRequestDuration&&f<l&&d.error({code:"-2",message:""})}},1e4);t.done(function(e){d.complete(e)},function(e){d.error(e)});d.getPromise().done(function(){a&&o.async.clearTimeout(a);_&&o.async.clearInterval(_)},function(){t.cancel();a&&o.async.clearTimeout(a);_&&o.async.clearInterval(_)});return d.getPromise()};e.prototype._getItemKey=function(){var e,t=this._itemUrlHelper.getItemUrlParts(this._parentItem.key),r=t.serverRelativeItemUrl,a=t.normalizedListUrl,o=r+"/"+this._fileUpload.name;return this._urlDataSource.getKey(((e={}).id=o,e.listurl=a,e))};e.dependencies=r.__assign({},a.default.dependencies,{itemProvider:n.resourceKey,urlDataSource:m.url,itemParentHelper:T.resourceKey,itemUrlHelper:y.resourceKey,apiUrlHelper:v.resourceKey,dataRequestorType:_.typeResourceKey,itemTaskObserverType:E.resourceKey});return e}(a.default);t.default=q;t.typeResourceKey=D.createResolvedTypeResourceKey(e("module").id,q)});define("uX",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Html5="h5"});define("uZ",["require","exports","aC","c6","bA"],function(r,e,t,a,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.resourceKey=new o.ResourceKey({name:"provider.clientForm.async",loader:new o.AliasResourceLoader(function(){return a.loadModuleExport({path:"NQ",getModule:function(){return new t.default(function(e,t){r(["NQ"],e,t)})},getExport:function(e){return e.resourceKey}})})})});define("uO",["require","exports","ap","bN","sP","uL","fd","aC","bE","ia","uW","bA","uQ","dY","uP","eL","aN"],function(e,t,s,r,u,n,l,d,p,a,c,o,i,m,f,h,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.uploadQueueResourceKey=new o.ResourceKey({name:e("module").id+".uploadQueue",factory:{dependencies:{},create:function(){return{instance:new a.default(3)}}}});var v=0,_=function(o){s.__extends(e,o);function e(e,t){var r=o.call(this,e,t)||this,a=e.fileUpload;r._qosData={uploadId:""+ ++v,uploaderType:"Vroom"};r._vroomUploader=t.vroomUploader;r._uploadQueue=t.uploadQueue;r._graphDataSource=t.graphDataSource;r._itemResultProcessor=t.itemResultProcessor;r._itemTaskObserver=new t.itemTaskObserverType;r._parentItem=e.parentItem;r._fileUpload=a;r._qosContext=e.qosContext;r.state=r.createObservable(0);r.uploadedBytes=r.createObservable(0);r.totalBytes=r.createObservable(a.size);r.fileName=r.createObservable(a.name);r.iconName=r.createObservable(a.iconName);r.error=r.createObservable();r.nameConflictBehavior=r.createObservable(0);r.allowRename=!0;r.item=r.createObservable();return r}e.prototype.start=function(){this._uploadPromise=this.trackPromise(this._upload())};e.prototype.abort=function(){delete this._fileUpload;var e=this._pendingRestart;delete this._pendingRestart;if(e)e.cancel();else{var t=this._uploadPromise;delete this._uploadPromise;if(t){t.cancel();t.done(function(){},function(){})}}};e.prototype.restart=function(){var e=this,t=this._pendingRestart;delete this._pendingRestart;if(t)t.complete();else{var r=this._uploadPromise;delete this._uploadPromise;if(r){r.cancel();r.done(function(){e.start()},function(){e.start()})}}};e.prototype._upload=function(){var n=this,t=this._fileUpload;this.uploadedBytes(0);this.error(void 0);if(!t){this.state(4);return d.default.wrap()}this.state(0);var e=this._qosContext,i=new l.Upload({name:"Upload."+e.uploadType,size:t.size,extension:t.extension.substring(1),dragAndDrop:e.isDragAndDrop,folderUpload:e.isFolderUpload,groupFolder:!1,extraData:this._qosData});return this._enqueue().then(function(){n.state(1);var e=n._parentItem;return n._vroomUploader.upload({qosData:n._qosData,itemUrl:n._graphDataSource.getItemUrl(e,{useDirectEndpoint:!0,isPath:!0}),accessToken:n._graphDataSource.getAccessToken(e),fileName:t.name,content:t,lastModifiedDate:t.lastModifiedDate,eTag:t.eTag,conflictBehavior:g(n.nameConflictBehavior.peek()),onProgress:n.async.debounce(function(e){e>n.uploadedBytes.peek()&&n.uploadedBytes(e)},100,{leading:!1}),onPromptForConfictBehavior:function(e){return n._promptForConflictBehavior(e)},onWait:function(e){return n._wait(e)}})}).then(function(e){n._dequeue();return e},function(e){n._dequeue();return d.default.wrapError(e)}).then(function(e){var t=n._itemTaskObserver,r=n._itemResultProcessor.processItem({itemFromServer:e,requestKey:n._parentItem.key,observer:t}).key;t.update([new h.Task(r).succeed({item:{key:r,parentKey:n._parentItem.key}})]);t.flush();var a=t.getItem({key:r});".txt"===a.extension&&n.fileName(""+a.displayName+a.extension);n.item(a)}).then(function(){n.uploadedBytes(t.size);delete n._fileUpload;n.error(void 0);n.state(2);i.end({resultType:l.ResultTypeEnum.Success})},function(e){if(d.default.isCanceled(e)){var t=n.state.peek();n.error(void 0);n.state(3);var r=void 0;switch(t){case 0:r="Dequeued";break;case 4:r="Ignored";break;default:r="Aborted"}i.end({resultType:l.ResultTypeEnum.ExpectedFailure,resultCode:r,extraData:s.__assign({},n._qosData,{lastByte:n.uploadedBytes.peek()})})}else{c.isGraphError(e)||y.default.logError(e);var a=n._getUploadError(e),o=a.errorType;n.error(a);n.state(4);i.end({resultType:function(e){switch(e){case u.UploadErrorType.conflict:case u.UploadErrorType.invalidName:case u.UploadErrorType.folderUploadNotSupported:case u.UploadErrorType.emptyFileOrFolder:case u.UploadErrorType.emptyFileOrFolderForDocLib:case u.UploadErrorType.lockMismatch:case u.UploadErrorType.overQuota:case u.UploadErrorType.fileSize:return!0;default:return!1}}(o)?l.ResultTypeEnum.ExpectedFailure:l.ResultTypeEnum.Failure,resultCode:u.UploadErrorType[o],error:a.message,extraData:s.__assign({},n._qosData,a.extraData,{lastByte:n.uploadedBytes.peek()})})}return d.default.wrapError(e)})};e.prototype._promptForConflictBehavior=function(e){var t=this;this._dequeue();var r=new p.default;this._pendingRestart=r;var a=e?this._getUploadError(e):new n.UploadError({message:"",errorType:u.UploadErrorType.conflict,allowRename:this.allowRename});this.error(a);this.state(4);return r.getPromise().then(function(){var e=t.nameConflictBehavior.peek();t.error(void 0);t.state(0);return t._enqueue().then(function(){t.state(1);return d.default.wrap(g(e))})})};e.prototype._enqueue=function(){var e=new p.default;this._queueBlocker=e;var t=new p.default(function(){e.cancel()});this._uploadQueue.enqueue(function(){t.complete();return e.getPromise()});return t.getPromise()};e.prototype._dequeue=function(){var e=this._queueBlocker;delete this._queueBlocker;e&&e.complete()};e.prototype._wait=function(e){var t,r=this,a=e.duration,o=e.allowWakeWhenOnline,n=void 0!==o&&o,i=new p.default(function(){r.async.clearTimeout(t)}),s=function(){n&&i.complete()};t=this.async.setTimeout(function(){i.complete()},a);this.events.on(window,"online",s);return i.getPromise().then(function(){r.events.off(window,"online",s)},function(e){r.events.off(window,"online",s);return d.default.wrapError(e)})};e.prototype._getUploadError=function(e){return new n.UploadError({message:e.message,errorType:function(e){var t=c.getErrorResolution(e,function(e){switch(e){case"pathIsTooLong":case"pathIsTooDeep":case"invalidPath":case"nameContainsInvalidCharacters":return u.UploadErrorType.invalidName;case"accessRestricted":case"activityLimitReached":case"unauthenticated":case"accessDenied":case"itemNotFound":case"notSupported":case 401:case 403:case 404:case 429:return u.UploadErrorType.accessDenied;case"nameAlreadyExists":case 409:return u.UploadErrorType.conflict;case"entityTagDoesNotMatch":case"versionNumberDoesNotMatch":case"resourceModified":case 412:return u.UploadErrorType.versionMismatch;case"maxFileSizeExceeded":case 413:return u.UploadErrorType.fileSize;case 415:return u.UploadErrorType.emptyFileOrFolder;case"lockMismatch":case"lockNotFoundOrAlreadyExpired":case"lockOwnerMismatch":case 423:return u.UploadErrorType.lockMismatch;case"maxDocumentCountExceeded":case"maxFolderCountExceeded":case"maxItemCountExceeded":case"quotaLimitReached":case 507:return u.UploadErrorType.overQuota;case"generalException":case"malwareDetected":case"invalidRange":case"invalidRequest":case"notAllowed":case"resyncRequired":case"serviceNotAvailable":case"virusSuspicious":case"uploadSessionNotFound":case 400:case 405:case 411:case 422:case 500:case 501:case 503:return}});void 0===t&&(t=u.UploadErrorType.general);return t}(e),allowRename:this.allowRename,extraData:c.getQosExtraDataFromError(e)})};e.dependencies=s.__assign({},r.default.dependencies,{vroomUploader:i.resourceKey,uploadQueue:t.uploadQueueResourceKey,itemResultProcessor:f.resourceKey,itemTaskObserverType:h.resourceKey,graphDataSource:m.graph});return e}(r.default);t.SingleFileUploader=_;function g(e){var t;switch(e){case 1:case 3:t="replace";break;case 2:t="rename";break;default:case 0:t="fail"}return t}t.resourceKey=new o.ResourceKey({name:e("module").id,factory:new o.ResolvedResourceTypeFactory(_)});t.default=_});define("uW",["require","exports","ap","gc"],function(e,t,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r.__exportStar(a,t)});define("gc",["require","exports","aL"],function(e,t,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t){var r=t.response,a=(void 0===r?{}:r).error,o=(void 0===a?{}:a).innererror,n=(void 0===o?{}:o).stackTrace,i=void 0===n?"":n,s=t.response,u=t.request,l=t.status,d=e.message;this.name="GraphError";this.message=d;(this.type=this).response=s;this.status=l;this.serverStack=i;this.request=u;this.error=e;return p.extend(e,this)};t.GraphError=r;var n="errorMessage",i="vroomStatus",s="vroomErrorCode",u="vroomErrorMessage",l="vroomErrorInnerCode",d="vroomErrorInnerMessage",c="vroomErrorInnerDebugMessage",m="vroomErrorInnerStack";t.getQosExtraDataFromError=function(e){var t={};t[n]=e.message;if(f(e)){t[i]=e.status;var r=e.response;if(r&&r.error){var a=r.error;t[s]=a.code;t[u]=a.message;var o=a.innererror;if(o){t[l]=o.code;t[d]=o.message;t[c]=o.debugMessage;t[m]=o.stackTrace}}}return t};function f(e){return e.type instanceof r}t.isGraphError=f;function a(e,t){if(f(e)){var r=e.response,a=e.status;if(r){for(var o=[],n=r.error;n;){o.push(n);n=n.innererror}for(;n=o.pop();){var i=t(n.code,e);if(void 0!==i)return i}}return t(a,e)}}t.getErrorResolution=a;t.getResultCodeFromError=function(e){return a(e,function(e){return""+e})||"unhandled"}});define("uQ",["require","exports","uR","f9","bb","bA"],function(e,t,r,a,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.performanceNowResourceKey=new n.ResourceKey({name:e("module").id+".performanceNow",factory:new n.ConstantResourceFactory(r.performanceNow)});t.vroomUploadServiceResourceKey=new n.ResourceKey({name:e("module").id+".vroomUploadService",factory:new n.ResolvedResourceFactory(r.UploadService,{dataRequestor:a.resourceKey})});t.useCommitForVroomUploadResourceKey=new n.ResourceKey({name:e("module").id+".useCommitForVroomUpload",factory:new n.ConstantResourceFactory(o.isFeatureEnabled(o.UseCommitForVroomUpload))});t.useStreamingUploadResourceKey=new n.ResourceKey({name:e("module").id+".useStreamingUpload",factory:new n.ConstantResourceFactory(o.isFeatureEnabled(o.EnableStreamingUpload))});t.activityBandwidthVerifierTypeResourceKey=new n.ResourceKey({name:e("module").id+".activityBandwidthVerifier",factory:new n.ResolvedResourceTypeFactory(r.ActivityBandwidthVerifier,{performanceNow:t.performanceNowResourceKey})});t.vroomUploadStateMachineResourceKey=new n.ResourceKey({name:e("module").id+".vroomUploadStateMachine",factory:new n.ResolvedResourceFactory(r.UploadStateMachine,{uploadService:t.vroomUploadServiceResourceKey,activityBandwidthVerifierType:t.activityBandwidthVerifierTypeResourceKey,useCommitForUpload:t.useCommitForVroomUploadResourceKey})});t.resourceKey=n.createResolvedResourceKey(e("module").id,r.Uploader,{uploadService:t.vroomUploadServiceResourceKey,uploadStateMachine:t.vroomUploadStateMachineResourceKey,useStreamingUpload:t.useStreamingUploadResourceKey});t.default=r.Uploader});define("uR",["require","exports","ap","uV","uU","uT","uS"],function(e,t,r,a,o,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r.__exportStar(a,t);r.__exportStar(o,t);r.__exportStar(n,t);r.__exportStar(i,t)});define("uV",["require","exports","ap","aC","gc","aI"],function(e,t,n,s,i,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){var r=t.uploadService,a=t.uploadStateMachine,o=t.useStreamingUpload,n=void 0!==o&&o;this._uploadService=r;this._uploadStateMachine=a;this._useStreamingUpload=n}e.prototype.upload=function(e){var t=e.conflictBehavior,r=n.__rest(e,["conflictBehavior"]),a=r.qosData,o=new u.Qos({name:"VroomUploader.upload",extraData:a});return this._uploadState(r,{conflictBehavior:t,allowStreaming:this._useStreamingUpload}).then(function(e){o.end({resultType:u.ResultTypeEnum.Success});return e},function(e){o.end({resultType:s.default.isCanceled(e)?u.ResultTypeEnum.ExpectedFailure:u.ResultTypeEnum.Failure,error:e.message,resultCode:i.getResultCodeFromError(e),extraData:n.__assign({},a,i.getQosExtraDataFromError(e))});return s.default.reject(e)})};e.prototype._uploadState=function(t,e){var r=this,a=e.sessionUrl,o=e.item,n=e.error;if(o)return s.default.resolve(o);if(n){var i=void 0;a&&(i=this._uploadService.cancelSession({qosData:t.qosData,sessionUrl:a}).then(function(){},function(){}));return s.default.resolve(i).then(function(){return s.default.reject(n)})}return this._uploadStateMachine.advanceState(t,e).then(function(e){return r._uploadState(t,e)})};return e}();t.Uploader=r;t.default=r});define("uU",["require","exports","ap","bE"],function(e,t,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this._dataRequestor=t.dataRequestor}e.prototype.createSession=function(e){var t=e.qosData,r=e.itemUrl,a=e.accessToken,o=e.fileName,n=e.fileSize,i=e.lastModifiedDate,s=e.eTag,u=e.conflictBehavior,l={item:m.__assign({},p(r)?{"@microsoft.graph.conflictBehavior":u}:{"@name.conflictBehavior":u},{fileSystemInfo:{lastModifiedDateTime:i?i.toISOString():void 0}})},d=m.__assign({},s?{"If-Match":s}:{},{Prefer:"synchronousmetadata"});return this._dataRequestor.send({path:r+"/"+encodeURIComponent(o)+":/"+(p(r)?"createUploadSession":"oneDrive.createUploadSession"),requestType:"POST",apiName:"CreateSession",headers:d,accessToken:a,useAuthorizationHeaders:!0,postData:JSON.stringify(l),qosExtraData:m.__assign({conflictBehavior:u,fileSize:n},t)})};e.prototype.cancelSession=function(e){var t=e.qosData,r=e.sessionUrl;return this._dataRequestor.send({requestType:"DELETE",apiName:"CancelSession",path:r,needsAuthorization:!1,qosExtraData:t})};e.prototype.uploadFragment=function(e){var t=e.qosData,r=e.sessionUrl,a=e.startByte,o=e.endByte,n=e.fileSize,i=e.content,s=e.timeout,u=e.onProgress,l={"Content-Range":"bytes "+a+"-"+Math.max(o-1,a)+"/"+n},d=!0,p=this._dataRequestor.send({path:r,needsAuthorization:!1,requestType:"PUT",apiName:"UploadFragment",headers:l,postData:i,timeout:s,onUploadProgress:function(e){e.lengthComputable&&d&&u(a+e.loaded)},qosExtraData:m.__assign({},t,{startByte:a,endByte:o,fileSize:n})}),c=new f.default(function(){d=!1;p.cancel()});p.done(function(e){d=!1;c.complete(e)},function(e){d=!1;c.error(e)});return c.getPromise()};e.prototype.commit=function(e){var t=e.qosData,r=e.itemUrl,a=e.accessToken,o=e.fileName,n=(e.description,e.eTag),i=e.conflictBehavior,s=e.sessionUrl,u={"If-Match":n},l=p(r)?{"@microsoft.graph.conflictBehavior":i,"@microsoft.graph.sourceUrl":s}:{"@name.conflictBehavior":i,"@content.sourceUrl":s};return this._dataRequestor.send({path:r+"/"+encodeURIComponent(o),requestType:"PUT",apiName:"CommitSession",headers:u,accessToken:a,useAuthorizationHeaders:!0,postData:JSON.stringify(l),qosExtraData:m.__assign({conflictBehavior:i},t)})};e.prototype.getStatus=function(e){var t=e.qosData,r=e.sessionUrl;return this._dataRequestor.send({requestType:"GET",apiName:"GetStatus",path:r,needsAuthorization:!1,qosExtraData:t})};e.prototype.getItem=function(e){var t=e.qosData,r=e.itemUrl,a=e.accessToken,o=e.fileName;return this._dataRequestor.send({requestType:"GET",apiName:"GetItem",path:r+"/"+encodeURIComponent(o),useAuthorizationHeaders:!0,accessToken:a,qosExtraData:m.__assign({},t)})};return e}();t.UploadService=r;function p(e){return 0===e.toLowerCase().lastIndexOf("https://graph.microsoft.com",0)}});define("uT",["require","exports","ap","gc","aI","aC","bE"],function(e,t,T,E,F,s,R){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=62914560,w=1/1920,x=Math.pow(2,.25),r=function(){function e(e,t){this._uploadService=t.uploadService;this._activityBandwidthVerifierType=t.activityBandwidthVerifierType;var r=t.useCommitForUpload,a=void 0!==r&&r,o=t.checkForCompletedUploadOnSessionTermination,n=void 0===o||o,i=t.maximumFragmentSize,s=void 0===i?u:i;this._useCommitForUpload=a;this._checkForCompletedUploadOnSessionTermination=n;this._maximumFragmentSize=s}e.prototype.advanceState=function(t,e){var r=this,a=e.sessionUrl,o=e.nextExpectedRanges;return(a?o?this._uploadItemState(t,e):this._getStatusState(t,e):this._createSessionState(t,e)).then(function(e){return e.error?r._handleGeneralErrorState(t,e):r._getState(e,{waitDuration:void 0,attemptsRemaining:void 0})})};e.prototype._createSessionState=function(e,r){var a=this,o=e.qosData,n=new F.Qos({name:"VroomUploader.createSession",extraData:o});return this._uploadService.createSession({qosData:o,itemUrl:e.itemUrl,accessToken:e.accessToken,fileName:e.fileName,fileSize:e.content.size,eTag:e.eTag,lastModifiedDate:e.lastModifiedDate,conflictBehavior:r.conflictBehavior}).then(function(e){n.end({resultType:F.ResultTypeEnum.Success});return a._getState(r,{nextExpectedRanges:e.nextExpectedRanges,sessionUrl:e.uploadUrl})},function(t){return a._handleCreateSessionErrorState(e,a._getState(r,{error:t})).then(function(e){e.error?n.end({resultType:F.ResultTypeEnum.Failure,error:t.message,resultCode:E.getResultCodeFromError(t),extraData:T.__assign({},o,E.getQosExtraDataFromError(t))}):n.end({resultType:F.ResultTypeEnum.ExpectedFailure,resultCode:"Canceled"});return e})})};e.prototype._handleCreateSessionErrorState=function(r,a){var o=this;return this._handleErrorState(a,function(e,t){switch(e){case"entityTagDoesNotMatch":case"resourceModified":case"versionNumberDoesNotMatch":case"nameAlreadyExists":case 409:case 412:return o._promptForConflictBehaviorState(t,r,a)}})};e.prototype._getStatusState=function(e,t){var r=this,a=e.qosData,o=new F.Qos({name:"VroomUploader.getStatus",extraData:a});return this._uploadService.getStatus({qosData:a,sessionUrl:t.sessionUrl}).then(function(e){o.end({resultType:F.ResultTypeEnum.Success});return r._getState(t,{nextExpectedRanges:e.nextExpectedRanges})},function(e){o.end({resultType:F.ResultTypeEnum.Failure,error:e.message,resultCode:E.getResultCodeFromError(e),extraData:T.__assign({},a,E.getQosExtraDataFromError(e))});return r._getState(t,{error:e})})};e.prototype._uploadItemState=function(t,e){var r=this,a=t.qosData,o=t.content.size,n=this._getNextRange({fileSize:o,nextExpectedRanges:e.nextExpectedRanges}),i=new F.Qos({name:"VroomUploader.uploadItem",extraData:t.qosData});return(n&&n.start<o?e.allowStreaming?this._uploadStreamState({nextRange:n},t,e):this._uploadFragmentState({nextRange:n},t,e):this._useCommitForUpload?this._commitState(t,e):this._cancelSessionState(t,e)).then(function(e){if(e.error)return r._handleUploadItemErrorState(t,e).then(function(e){var t=e.error;t?i.end({resultType:F.ResultTypeEnum.Failure,error:t.message,resultCode:E.getResultCodeFromError(t),extraData:T.__assign({},a,E.getQosExtraDataFromError(t))}):i.end({resultType:F.ResultTypeEnum.Success});return e});i.end({resultType:F.ResultTypeEnum.Success});return e})};e.prototype._uploadFragmentState=function(e,t,r){var a=this,o=e.nextRange,n=t.onProgress,i=t.content,s=t.content.size,u=t.qosData,l=r.sessionUrl,d=r.speed,p=void 0===d?1/8:d,c=o.start,m=o.end;n&&n(c);var f,h,y=this._getFragmentSize(p),v=Math.min(c+y,m),_=new R.default(function(){f&&f.cancel()}),g=w<p?6e4:3e5,U=new this._activityBandwidthVerifierType({timeout:g,totalBytes:v-c}),S=new F.Qos({name:"VroomUploader.uploadFragment",extraData:T.__assign({},u,{startByte:c,endByte:v,fileSize:s,speed:p,fragmentSize:y})});(f=this._uploadService.uploadFragment({qosData:u,sessionUrl:l,startByte:c,endByte:v,fileSize:s,content:i.slice(c,v),timeout:g,onProgress:function(e){h=e;if(w<p&&!U.doesActivityHaveRemainingCapacity(e-c)){S.end({resultType:F.ResultTypeEnum.ExpectedFailure,resultCode:"Aborted",extraData:T.__assign({},u,{lastByte:e})});_.complete(a._getState(r,{speed:Math.max(.5*p,w),nextExpectedRanges:void 0}));f&&f.cancel()}n&&n(e)}}).then(function(e){n&&n(v);S.end({resultType:F.ResultTypeEnum.Success});return r=a._isItem(e)?a._getState(r,{item:e}):a._getState(r,{nextExpectedRanges:e.nextExpectedRanges,speed:Math.min(U.didActivityHaveExtraCapacity()?p*x:p,1)})},function(e){S.end({resultType:F.ResultTypeEnum.Failure,error:e.message,resultCode:E.getResultCodeFromError(e),extraData:T.__assign({},u,E.getQosExtraDataFromError(e),{lastByte:h})});return a._getState(r,{error:e})})).done(function(e){_.complete(e)});return _.getPromise()};e.prototype._uploadStreamState=function(e,t,r){var a=this,o=e.nextRange,n=t.onProgress,i=t.content,s=t.content.size,u=t.qosData,l=r.sessionUrl,d=o.start,p=o.end,c=Math.min(p-d,this._maximumFragmentSize),m=d+c;n&&n(d);var f,h=new R.default(function(){f&&f.cancel()}),y=new F.Qos({name:"VroomUploader.uploadStream",extraData:T.__assign({},u,{startByte:d,endByte:m,fileSize:s,fragmentSize:c})});(f=this._uploadService.uploadFragment({qosData:u,sessionUrl:l,startByte:d,endByte:m,fileSize:s,content:i.slice(d,m),timeout:864e5,onProgress:function(e){n&&n(e)}}).then(function(e){n&&n(m);y.end({resultType:F.ResultTypeEnum.Success});return r=a._isItem(e)?a._getState(r,{item:e}):a._getState(r,{nextExpectedRanges:e.nextExpectedRanges})},function(e){y.end({resultType:F.ResultTypeEnum.Failure,error:e.message,resultCode:E.getResultCodeFromError(e),extraData:T.__assign({},u,E.getQosExtraDataFromError(e),{lastByte:void 0})});return a._handleUploadStreamErrorState({nextRange:o},t,a._getState(r,{error:e}))})).done(function(e){h.complete(e)});return h.getPromise()};e.prototype._handleUploadStreamErrorState=function(e,t,r){var a=this,o=e.nextRange;return this._handleErrorState(r,function(e){switch(e){case 0:return a._wait({duration:1e3},t).then(function(){return a._getStatusState(t,r).then(function(e){return a._getNextRange({fileSize:t.content.size,nextExpectedRanges:e.nextExpectedRanges}).start>o.start?e:a._getState(r,{allowStreaming:!1})})})}})};e.prototype._commitState=function(e,r){var a=this,o=e.qosData,t=e.onProgress;t&&t(e.content.size);var n=new F.Qos({name:"VroomUploader.commit",extraData:o});return this._uploadService.commit({qosData:o,itemUrl:e.itemUrl,accessToken:e.accessToken,fileName:e.fileName,sessionUrl:r.sessionUrl,conflictBehavior:r.conflictBehavior}).then(function(e){n.end({resultType:F.ResultTypeEnum.Success});return a._getState(r,{item:e})},function(t){return a._handleCommitErrorState(a._getState(r,{error:t})).then(function(e){n.end({resultType:e.error?F.ResultTypeEnum.Failure:F.ResultTypeEnum.ExpectedFailure,error:t.message,resultCode:E.getResultCodeFromError(t),extraData:T.__assign({},o,E.getQosExtraDataFromError(t))});return e})})};e.prototype._handleCommitErrorState=function(t){var r=this;return this._handleErrorState(t,function(e){switch(e){case"uploadSessionFailed":case"uploadSessionNotFound":case 410:return s.default.resolve(r._getState(t,{error:void 0,sessionUrl:void 0}))}})};e.prototype._cancelSessionState=function(e,t){var r=this,a=e.qosData,o=new F.Qos({name:"VroomUploader.cancelSession",extraData:a});return this._uploadService.cancelSession({qosData:e.qosData,sessionUrl:t.sessionUrl}).then(function(){o.end({resultType:F.ResultTypeEnum.Success});return r._getState(t,{sessionUrl:void 0})},function(e){o.end({resultType:F.ResultTypeEnum.Failure,error:e.message,resultCode:E.getResultCodeFromError(e),extraData:T.__assign({},a,E.getQosExtraDataFromError(e))});return r._getState(t,{sessionUrl:void 0})})};e.prototype._handleUploadItemErrorState=function(r,a){var o=this,e=a.speed,n=void 0===e?1:e;a=this._getState(a,{nextExpectedRanges:void 0});return this._handleErrorState(a,function(e,t){switch(e){case 0:return window.navigator.onLine?a.allowStreaming?s.default.resolve(o._getState(a,{allowStreaming:!1})):s.default.resolve(o._getState(a,{speed:Math.max(n*(1/8),w)})):void 0;case"uploadSessionFailed":case"uploadSessionNotFound":case 404:return s.default.resolve(o._getState(a,{error:void 0,sessionUrl:void 0}));case"entityTagDoesNotMatch":case"resourceModified":case"versionNumberDoesNotMatch":case"nameAlreadyExists":case 409:case 412:return o._promptForConflictBehaviorState(t,r,a);case"invalidRange":case 416:return o._wait({duration:1e3},r).then(function(){return o._getState(a,{error:void 0})})}})};e.prototype._getItemIfCompletedState=function(t,r){var a=this,o=t.qosData,n=new F.Qos({name:"VroomUploader.getItemIfCompleted",extraData:o});return this._uploadService.getItem({qosData:o,fileName:t.fileName,itemUrl:t.itemUrl,accessToken:t.accessToken}).then(function(e){n.end({resultType:F.ResultTypeEnum.Success});return t.lastModifiedDate&&e.fileSystemInfo&&e.fileSystemInfo.lastModifiedDateTime===t.lastModifiedDate.toISOString()&&e.size===t.content.size&&"rename"!==r.conflictBehavior?a._getState(r,{item:e,error:void 0}):a._getState(r,{error:new Error("The upload session has terminated but the existing item does not match the input.")})},function(e){n.end({resultType:F.ResultTypeEnum.Failure,error:e.message,resultCode:E.getResultCodeFromError(e),extraData:T.__assign({},o,E.getQosExtraDataFromError(e))});return a._getState(r,{error:e})})};e.prototype._handleGeneralErrorState=function(t,r){var a=this,e=r.waitDuration,o=void 0===e?500:e,n=r.attemptsRemaining,i=void 0===n?10:n;return this._handleErrorState(r,function(e){switch(e){case"uploadSessionNotFound":return a._checkForCompletedUploadOnSessionTermination?a._getItemIfCompletedState(t,r):void 0;case"unauthenticated":case 401:case"lockMismatch":case 423:case 501:case"quotaLimitReached":case 507:return}if("number"==typeof e){if(400<=e&&e<500)return;if(0===e||500<=e&&e<600)return a._wait({duration:o,allowWakeWhenOnline:!0},t).then(function(){return a._getState(r,{error:void 0,waitDuration:Math.min(2*o,3e4),attemptsRemaining:void 0})});if(!i)return;return a._wait({duration:1e3},t).then(function(){return a._getState(r,{error:void 0,waitDuration:void 0,attemptsRemaining:Math.max(i-1,0)})})}})};e.prototype._handleErrorState=function(e,t){var r=e.error,a=E.getErrorResolution(r,t);void 0===a&&(a=s.default.resolve(e));return a};e.prototype._promptForConflictBehaviorState=function(t,e,r){var a=this,o=e.onPromptForConfictBehavior,n=e.qosData,i=new F.Qos({name:"VroomUploader.promptForConflictBehavior",extraData:n});return s.default.resolve().then(function(){return o(t)}).then(function(e){i.end({resultType:F.ResultTypeEnum.Success,extraData:n});return a._getState(r,{error:void 0,conflictBehavior:e})},function(e){i.end({resultType:F.ResultTypeEnum.Failure,error:e.message,resultCode:E.getResultCodeFromError(t),extraData:T.__assign({},n,E.getQosExtraDataFromError(e))});return a._getState(r,{error:e})})};e.prototype._wait=function(e,t){var r=e.duration,a=e.allowWakeWhenOnline,o=t.onWait,n=t.qosData,i=new F.Qos({name:"VroomUploader.wait",extraData:n});return s.default.resolve(o({duration:r,allowWakeWhenOnline:a})).then(function(){i.end({resultType:F.ResultTypeEnum.Success})},function(e){i.end({resultType:s.default.isCanceled(e)?F.ResultTypeEnum.Success:F.ResultTypeEnum.Failure,error:e&&e.message,resultCode:E.getResultCodeFromError(e)});return s.default.reject(e)})};e.prototype._getState=function(e,t){return T.__assign({},e,t)};e.prototype._getNextRange=function(e){var s=e.fileSize,t=e.nextExpectedRanges;return(void 0===t?[]:t).reduce(function(e,t){var r,a=t.split("-",2),o=a[0],n=a[1],i=parseInt(o,10);if(!e||i<e.start&&i<s){r={start:i,end:""===n?s:Math.min(parseInt(n,10)+1,s)}}else r=e;return r},void 0)};e.prototype._isItem=function(e){return!!e.id};e.prototype._getFragmentSize=function(e){var t,r=e*u;t=327680<r?r-r%327680:r-r%32768;return Math.min(Math.max(t,32768),this._maximumFragmentSize)};return e}();t.UploadStateMachine=r});define("uS",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.performanceNow=window.performance?function(){return window.performance.now()}:function(){return Date.now()};var r=function(){function e(e,t){this._performanceNow=t.performanceNow;this._startTime=this._performanceNow();this._expirationTime=this._startTime+e.timeout;this._totalBytes=e.totalBytes;this._progressPoints=0}e.prototype.doesActivityHaveRemainingCapacity=function(e){var t=this._getRateRatio(e);return void 0===t||t<=1};e.prototype.didActivityHaveExtraCapacity=function(){return this._getRateRatio(this._totalBytes)<=.5};e.prototype._getRateRatio=function(e){this._progressPoints++;var t,r=this._performanceNow(),a=r-this._startTime,o=this._expirationTime-r,n=this._totalBytes-e;(4<=this._progressPoints&&4e3<=a||0<this._progressPoints&&0===n)&&0<o&&(t=n/o/(e/a));return t};return e}();t.ActivityBandwidthVerifier=r});define("f9",["require","exports","bA","dY","gd","ga"],function(e,t,r,a,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.resourceKey=r.createResolvedResourceKey(e("module").id,n.DataRequestor,{sessionManagementProvider:o.resourceKey,urlDataSource:a.url});t.default=n.DataRequestor});define("gd",["require","exports","cX","aC","dY","bA"],function(e,t,r,a,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this._identityDataSource=t.identityDataSource;this._microServiceDataSource=t.microServiceDataSource}e.prototype.getToken=function(t){var e=this._identityDataSource.getIdentity().type;if(e===r.IdentityType.aad){if(this._microServiceDataSource)return this._microServiceDataSource.getAuthData().then(function(e){if(e)return t&&"v2.1"===t?{accessToken:e.authTokenV21,proofToken:e.proofTokenV21,tokenUrl:e.tokenUrlV21}:{accessToken:e.authToken,proofToken:e.proofToken,tokenUrl:e.tokenUrl}},function(e){return a.default.resolve()})}else if(e===r.IdentityType.msa)return this._identityDataSource.getSessionToken();return a.default.reject(new Error("Cannot request a token for an unauthenticated user."))};e.dependencies={identityDataSource:o.identity,microServiceDataSource:o.microService.optional};return e}();t.default=i;t.resourceKey=n.createResolvedResourceKey(e("module").id,i)});define("ga",["require","exports","ap","gb"],function(e,t,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r.__exportStar(a,t)});define("gb",["require","exports","ap","aC","fP","ca","aI","ei","gc"],function(e,t,E,F,R,w,x,D,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){var r=t.sessionManagementProvider,a=t.urlDataSource;this._sessionManagementProvider=r;this._apiName=a&&"function"==typeof a.getApiName?a.getApiName():"Vroom";this._apiBaseUrl=a?"function"==typeof a.getApiBaseUrl?a.getApiBaseUrl():a.getVroomApiBaseUrl():void 0}e.prototype.send=function(n){var i=this,e=n.headers,s=void 0===e?{}:e,u=n.path,l=n.apiName,t=n.requestType,d=void 0===t?"GET":t,r=n.disableLogging,p=void 0!==r&&r,c=n.timeout,m=n.onProgress,f=n.onUploadProgress,U=n.qosExtraData,a=n.apiVersion,o=void 0===a?"v2.0":a,h=n.needsAuthorization,y=void 0===h||h,v=n.useAuthorizationHeaders,S=void 0!==v&&v,_=n.accessToken,g=this._sessionManagementProvider,T=y&&(_||g&&g.getToken(o).catch(function(e){return F.default.reject(new b.GraphError(e,{status:0,response:{error:{code:"authFailure"}}}))}))||void 0;return F.default.resolve(T).then(function(v){var _,e=i._apiBaseUrl,t=E.__assign({Accept:"application/json"},n.postData?{"Content-Type":"application/json"}:{},s);if(v&&v.tokenUrl&&0===u.indexOf("/drive/"))_=new D.default(v.tokenUrl+"/"+u.substring(7));else{_=new D.default(u);e&&!_.getScheme()&&(_=new D.default(e+u))}var g,r=_.toString();if(v){var a=v.accessToken,o=v.proofToken;if(S){a&&(t=E.__assign({},t,{Authorization:"bearer "+a}));o&&(t=E.__assign({},t,{"X-PROOF_TOKEN":o}))}else{a&&_.setQueryParameter("access_token",a);o&&_.setQueryParameter("prooftoken",o)}}p||(g=new w.Api({url:r,name:i._apiName+"DataRequest."+l,extraData:U}));return R.default.start({url:_.toString(),headers:t,method:d,json:n.postData||"",requestTimeoutInMS:c,withCredentials:!1,onProgress:m,onUploadProgress:f}).then(function(e){g&&g.end({resultType:x.ResultTypeEnum.Success});return n.parseResponse?n.parseResponse(e):0===e.responseText.length?null:JSON.parse(e.responseText)},function(e){var t,r,a;if(e instanceof Error){var o=F.default.isCanceled(e)?x.ResultTypeEnum.ExpectedFailure:x.ResultTypeEnum.Failure;r={error:e.message,resultType:o};a=e}else{if(e.responseText)try{t=JSON.parse(e.responseText)}catch(a){}var n=e.status,i=e.statusText,s=(t||{}).error,u=void 0===s?{}:s,l=u.message,d=void 0===l?"":l,p=u.innererror,c=void 0===p?{}:p,m=c.stackTrace,f=void 0===m?"":m,h=c.debugMessage,y=void 0===h?"":h;a=new b.GraphError(new Error(d),{response:t,status:n,request:e});r={resultType:x.ResultTypeEnum.Failure,error:d,extraData:E.__assign({},U||{},b.getQosExtraDataFromError(a),{stack:f,httpStatus:n,httpStatusText:i,requestId:e.getResponseHeader("request-id")||e.getResponseHeader("sprequestguid"),debugMessage:y,accessTokenLength:v&&v.accessToken?v.accessToken.length:-1,urlLength:_.toString().length})}}g&&g.end(r);return F.default.reject(a)})})};return e}();t.DataRequestor=r;t.default=r});define("uP",["require","exports","dG","eG","gu","dY","gH","dp","dj","bA","eL","hg","gW"],function(e,t,ae,oe,ne,r,ie,se,ue,a,le,o,de){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){var r=t.urlDataSource,a=t.itemIdentityProcessor;this._urlDataSource=r;this._itemIdentityProcessor=a}e.prototype.processItem=function(e){var t=e.itemFromServer,r=e.requestKey,a=e.observer,o=this._itemIdentityProcessor.processIdentity({itemFromServer:t,requestKey:r,observer:a}).key,n=t.sharepointIds||{},i={key:o,properties:{listId:n.listId,ID:n.listItemId,uniqueId:n.listItemUniqueId}},s=this._urlDataSource.getKeyParams(r),u=this._urlDataSource.getQueryType(s);i.queryType=u;(i.displayType=u)===ae.default.SharedWithMe&&(i.external={});var l=t.id,d=t.name,p=t.folder,c=t.size,m=t.description,f=p?{name:d,extension:""}:ie.splitFileName(d),h=f.name,y=f.extension,v=function(e){var t,r=e.package;r&&"oneNote"===r.type?t=oe.default.OneNote:e.folder?t=oe.default.Folder:(a=e,o=ie.getFileExtension(a.name||"",!0),t=de.canOpenInMonaco(o||"")?oe.default.File:e.photo?oe.default.Media:e.video?oe.default.Media:e.thumbnails?oe.default.Media:oe.default.File);var a,o;return t}(t),_=t.parentReference;i.itemId=l;i.graph={itemId:l,driveId:le.Graft.optional(_&&_.driveId)};i.name=h;i.displayName=h;i.extension=y;i.size=c;i.caption=m;i.type=v;var g=t.searchResult;if(g){var U=g.onClickTelemetryUrl;U&&(i.urls=((te={})[ne.default.bingClickInstrumentation]=U,te))}if(p){var S=p.childCount;i.folder={childCount:S};i.childCount=S}var T=t.photo,E=t.image;if(T&&E){var F=E.width,R=E.height;i.photo={width:F,height:R}}var w=t.video;if(w){F=w.width,R=w.height;var x=w.bitrate,D=w.duration;i.video={width:F,height:R,bitrate:x,duration:D}}var b=t.lastModifiedBy,C=(void 0===b?{}:b).user,I=void 0===C?{}:C,k=I.email,P=void 0===k?void 0:k,q=I.displayName,N=void 0===q?void 0:q,M=t.createdBy,B=(void 0===M?{}:M).user,O=(void 0===B?{}:B).displayName,A=void 0===O?void 0:O,z=t.lastModifiedDateTime,K=t.createdDateTime,L=t.shared,Q=void 0===L?{}:L,H=Q.sharedBy,j=(void 0===H?{}:H).user,V=void 0===j?{}:j,G=V.email,W=void 0===G?void 0:G,Y=V.displayName,J=void 0===Y?void 0:Y,X=Q.sharedDateTime,Z=void 0===X?void 0:X;i.creatorName=A;i.editorName=N;var $=pe(z);i.dateModifiedTime=$.date;i.dateModified=$.dateString;$=pe(K);i.dateCreatedTime=$.date;i.dateCreated=$.dateString;$=pe(Z);i.dateSharedTime=$.date;i.dateShared=$.dateString;i.properties.sharedByUser={title:J,sip:W};i.properties.editorName=[{title:N,sip:P}];var ee=se.getIconNameFromItem({type:v,extension:y});i.iconName=ee;var te,re=v===oe.default.OneNote?"one":ee;re&&(i.appMap=ue.OfficeIconFileTypeMap[re]);i.openUrl=t.webUrl;i.itemFromServer=t;i.isPlaceholder=!1;a.update([new le.Task(o).succeed({item:i})]);return{key:o}};e.dependencies={urlDataSource:r.url,itemIdentityProcessor:r.vroomItemIdentityProcessor};return e}();t.ItemResultProcessor=n;var i="0001-01-01T00:00:00";function pe(e){var t=e&&0!==e.indexOf(i)?new Date(e):void 0;return{date:t,dateString:t?o.getRelativeDateTimeStringPast(t):""}}t.resourceKey=a.createResolvedResourceKey(e("module").id,n);t.default=n});define("uN",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,0,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];t.indexOfIllegalCharInUrlLeafName=function(e,t){for(var r,a,o=e.length,n=t.supportPoundStorePath,i=t.supportPercentStorePath,s=0;s<o;s++){r=e.charCodeAt(s);var u="#"===(a=e[s])&&n||"%"===a&&i;if(r<160&&!l[r]&&!u)return 1;if("."===a&&s===o-1)return 1}return-1}});